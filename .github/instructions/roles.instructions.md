---
applyTo: '**'
---
# دستورالعمل پروژه CV123.ir

## اطلاعات پایه پروژه
- **نام پروژه:** CV123
- **نسخه:** 1.0.0
- **وب‌سایت:** https://cv123.ir
- **مخزن گیت‌هاب:** https://github.com/123hassani-ai/cv123.ir.git
- **توضیحات:** سامانه استخدام نیرو در مجتمع کامپیوتر یک دو سه

## هدف پروژه
این سامانه با هدف مدیریت فرآیند استخدام نیرو در مجتمع کامپیوتر یک دو سه طراحی شده است. امکانات اصلی شامل ثبت درخواست متقاضیان، مدیریت فرآیند مصاحبه، ارزیابی هوشمند به کمک هوش مصنوعی و ارتباط با متقاضیان از طریق سامانه پیامکی می‌باشد.

## مشخصات فنی

### تکنولوژی‌های اصلی
- **فرانت‌اند:** HTML5, CSS3, JavaScript, Bootstrap 5, jQuery
- **بک‌اند:** PHP 8.1, OOP, MVC
- **دیتابیس:** MySQL 8.0 (port 3307)
- **محیط توسعه:** XAMPP
- **مدیریت کد:** Git, GitHub

### ویژگی‌های کلیدی
- **PWA:** پیاده‌سازی وب اپلیکیشن پیشرو
- **هوش مصنوعی:** ادغام با OpenAI برای ارزیابی هوشمند
- **سیستم پیامک:** اتصال به سامانه پیامکی ۰۰۹۸
- **رسپانسیو:** سازگاری کامل با دستگاه‌های مختلف
- **چندزبانه:** پشتیبانی کامل از زبان فارسی و RTL

## ساختار پروژه

### معماری
پروژه بر اساس معماری MVC (Model-View-Controller) پیاده‌سازی شده است:

```
cv123.ir/
├── app/                        # هسته اصلی برنامه
│   ├── controllers/            # کنترلرهای برنامه
│   ├── models/                 # مدل‌های برنامه
│   ├── views/                  # فایل‌های نمایشی
│   │   ├── admin/              # نماهای بخش مدیریت
│   │   ├── components/         # اجزای قابل استفاده مجدد
│   │   └── layouts/            # قالب‌های اصلی
│   ├── helpers/                # کلاس‌های کمکی
│   └── middleware/             # میان‌افزارها
├── config/                     # تنظیمات برنامه
├── database/                   # اسکریپت‌های دیتابیس
├── docs/                       # مستندات پروژه
├── logs/                       # لاگ‌های سیستم
├── public/                     # فایل‌های عمومی
│   ├── css/                    # استایل‌شیت‌ها
│   ├── js/                     # اسکریپت‌های جاوااسکریپت
│   │   └── admin/              # اسکریپت‌های بخش مدیریت
│   ├── images/                 # تصاویر

├── .gitignore                  # فایل‌های مستثنی شده از گیت
├── index.php                   # نقطه ورود اصلی برنامه
├── manifest.json               # فایل مانیفست PWA
└── service-worker.js           # سرویس ورکر PWA
```

## استانداردهای توسعه

### کدنویسی
1. **ساختار OOP:** استفاده از برنامه‌نویسی شیءگرا
2. **معماری MVC:** جداسازی منطق، داده و نمایش
3. **ماژولار:** طراحی به صورت ماژول‌های مستقل و قابل استفاده مجدد
4. **کامنت‌گذاری:** همه کدها به زبان فارسی کامنت‌گذاری شوند
5. **هدر فایل‌ها:** در سطر اول هر فایل، مسیر، نام و توضیحات آن درج شود

### سازگاری
1. **مرورگرها:** کروم، فایرفاکس، اج، سافاری
2. **دستگاه‌ها:** موبایل، تبلت، دسکتاپ (اولویت با موبایل)
3. **زبان:** فارسی و راست به چپ

### فناوری‌های الزامی
1. **فرانت‌اند:** Bootstrap 5, jQuery, AJAX, JSON
2. **بک‌اند:** PHP 8.1, Session Management
3. **طراحی:** فونت وزیرمتن

## مستندسازی

### قوانین مستندسازی
1. مستندات همیشه باید به‌روز باشند
2. تمامی تغییرات در مستندات پس از تأیید اعمال شوند
3. فایل‌های مستندات در پوشه `docs/` نگهداری شوند
4. هر قابلیت جدید باید مستندسازی شود

### فایل‌های مستندات موجود
- `README.md`: معرفی کلی پروژه و وضعیت پیشرفت
- `installation.md`: راهنمای نصب و راه‌اندازی (شامل راهنمای دیتابیس)
- `structure.md`: ساختار پروژه
- `api.md`: مستندات API
- `database.md`: ساختار دیتابیس (شامل اطلاعات Socket و اتصال)
- `ai_integration.md`: نحوه ادغام با OpenAI
- `sms_integration.md`: نحوه ادغام با سامانه پیامکی
- `settings.md`: راهنمای مدیریت تنظیمات مبتنی بر دیتابیس
- `logging_system_design.md`: **مستندات کامل سیستم لاگ‌گیری هوشمند (الزامی مطالعه)**
- `development.md`: راهنمای توسعه‌دهندگان (شامل مدیریت تنظیمات)
- `github.md`: گردش کار گیت‌هاب
- `CHANGELOG.md`: تاریخچه تغییرات پروژه
- `database/settings_migration.md`: راهنمای مهاجرت تنظیمات از JSON به دیتابیس

## اجزای اصلی سیستم

### کنترلرها
- **HomeController.php**: کنترلر صفحه اصلی
- **AuthController.php**: کنترلر احراز هویت (ورود، ثبت‌نام، خروج)
- **AdminController.php**: کنترلر بخش مدیریت (شامل مدیریت تنظیمات مبتنی بر دیتابیس)
- **SettingsController.php**: کنترلر تنظیمات سیستم و تست API‌ها
- **ChatController.php**: کنترلر چت هوش مصنوعی

### کلاس‌های کمکی
- **Database.php**: کلاس ارتباط با پایگاه داده (پشتیبانی از Socket در XAMPP macOS، یکپارچه با سیستم لاگ‌گیری)
- **Logger.php**: کلاس لاگ‌گیری هوشمند (ضروری - باید در تمام کدها استفاده شود)
- **Autoloader.php**: کلاس بارگذاری خودکار کلاس‌ها
- **Validator.php**: کلاس اعتبارسنجی داده‌ها
- **Auth.php**: کلاس مدیریت احراز هویت
- **OpenAIService.php**: کلاس رابط برای اتصال به سرویس هوش مصنوعی OpenAI (مبتنی بر دیتابیس)
- **SmsService.php**: کلاس رابط برای اتصال به سرویس‌های پیامک (مبتنی بر دیتابیس)

### امکانات ویژه
- **سیستم لاگ‌گیری هوشمند**: سیستم کاملی برای ثبت تمام فعالیت‌ها با پیام‌های دوزبانه و مدیریت خودکار فایل‌ها
- **مدیریت تنظیمات پیشرفته**: سیستم مدیریت تنظیمات مبتنی بر دیتابیس با گروه‌بندی
- **تست API**: امکان تست اتصال به OpenAI و سرویس پیامک از طریق پنل مدیریت
- **مدیریت محتوا**: صفحه مدیریت محتوا برای تغییر متن‌های سایت
- **پشتیبانی از XAMPP**: اتصال خودکار از طریق Unix Socket در محیط XAMPP macOS
- **مهاجرت تنظیمات**: امکان انتقال تنظیمات از فایل JSON به دیتابیس

## مدیریت ورژن و گیت

### قوانین گیت
1. استفاده از مخزن رسمی پروژه در گیت‌هاب
2. کامیت‌های منظم و با توضیحات مشخص
3. استفاده از `.gitignore` برای حذف فایل‌های غیرضروری
4. عدم ارسال اطلاعات حساس (کلیدهای API و اطلاعات دسترسی) به مخزن

### فایل‌های مستثنی از گیت
- فایل‌های سیستمی (`.DS_Store`, `Thumbs.db`)
- فایل‌های تنظیمات IDE
- فایل‌های پیکربندی محلی
- فایل‌های حساس (کلیدهای API)


## قوانین عمومی توسعه
1. هر تغییر باید با هماهنگی قبلی انجام شود
2. نصب هرگونه کتابخانه یا افزونه جدید نیاز به تأیید دارد
3. تغییر در قوانین برنامه‌نویسی نیاز به تأیید دارد
4. ساختار فایل‌ها و پوشه‌ها باید استاندارد و حرفه‌ای باشد
5. در حین کدنویسی باید برای اینکه وارد مرحله بعد شویم قبل از کدنویسی مشروح ان فرایند را توضیح دهیم و در صورت تایید وارد مرحله کدنویسی شویم
6. مدیریت خطاها به صورت کامل (نمایش پیام مناسب و ثبت در لاگ)

## 🚨 قوانین الزامی سیستم لاگ‌گیری (CRITICAL - هرگز فراموش نشود!)

### 🔥 اولویت اول: استفاده اجباری از Logger در تمام کدها

#### ✅ **الزامات مطلق:**
1. **هر کد PHP باید شامل لاگ‌گیری باشد** - این قانون قابل نقض نیست
2. **هر function، method، و عملیات مهم باید لاگ داشته باشد**
3. **تمام خطاها باید لاگ شوند** - هیچ خطایی نباید بدون لاگ بماند
4. **عملیات دیتابیس، API، و تعامل کاربر باید لاگ شوند**

#### 📝 **نحوه استفاده صحیح:**

```php
// 1. همیشه در ابتدای فایل Autoloader را فراخوانی کنید
require_once 'app/helpers/Autoloader.php';
Autoloader::register();

// 2. لاگ‌گیری عملیات معمولی
Logger::info('کاربر وارد صفحه اصلی شد', 'User accessed homepage');

// 3. لاگ‌گیری عملیات دیتابیس
Logger::database('کوئری کاربران اجرا شد', 'Users query executed', [
    'query' => 'SELECT * FROM users WHERE active = 1',
    'count' => $userCount
]);

// 4. لاگ‌گیری درخواست‌های API
Logger::api('درخواست به OpenAI ارسال شد', 'OpenAI request sent', [
    'model' => 'gpt-4',
    'prompt' => 'کوتاه شده...',
    'tokens' => 150
]);

// 5. لاگ‌گیری احراز هویت
Logger::auth('ورود موفق کاربر', 'Successful user login', [
    'user_id' => $userId,
    'username' => $username
]);

// 6. لاگ‌گیری خطاها (اجباری!)
try {
    // کد خطرناک
} catch (Exception $e) {
    Logger::error('خطا در پردازش درخواست', 'Request processing error', [
        'error' => $e->getMessage(),
        'file' => $e->getFile(),
        'line' => $e->getLine()
    ]);
}

// 7. لاگ‌گیری عملیات موفق
Logger::success('درخواست با موفقیت انجام شد', 'Request completed successfully');
```

#### 🗂️ **دسته‌بندی‌های اجباری:**
- `Logger::database()` - برای تمام عملیات دیتابیس
- `Logger::api()` - برای درخواست‌های API خارجی
- `Logger::auth()` - برای احراز هویت و امنیت
- `Logger::sms()` - برای عملیات پیامک
- `Logger::ai()` - برای تعامل با هوش مصنوعی
- `Logger::user()` - برای فعالیت‌های کاربر
- `Logger::error()` - برای تمام خطاها (اجباری!)

#### ⚠️ **خطاهای رایج که نباید رخ دهند:**
```php
// ❌ اشتباه - بدون لاگ
function updateUser($id, $data) {
    return $db->update('users', $data, $id);
}

// ✅ صحیح - با لاگ کامل
function updateUser($id, $data) {
    Logger::info('شروع به‌روزرسانی کاربر', 'Starting user update', ['user_id' => $id]);
    
    try {
        $result = $db->update('users', $data, $id);
        Logger::database('کاربر به‌روزرسانی شد', 'User updated successfully', [
            'user_id' => $id,
            'fields' => array_keys($data)
        ]);
        return $result;
    } catch (Exception $e) {
        Logger::databaseError('خطا در به‌روزرسانی کاربر', 'User update failed', [
            'user_id' => $id,
            'error' => $e->getMessage()
        ]);
        throw $e;
    }
}
```

#### 🎯 **نکات مهم برای Copilot:**
1. **هرگز کدی بدون لاگ ننویسید** - این قانون طلایی است
2. **همیشه خطاها را لاگ کنید** - exception handling بدون لاگ ممنوع است
3. **Context مناسب اضافه کنید** - اطلاعات مفیدی که کمک به دیباگ می‌کند
4. **از پیام‌های فارسی و انگلیسی استفاده کنید** - دوزبانه باشد
5. **در controller ها حتماً Logger را import کنید** - در ابتدای فایل

#### 📍 **چک‌لیست قبل از تکمیل هر کد:**
- [ ] آیا Autoloader فراخوانی شده؟
- [ ] آیا Logger در ابتدای فایل import شده؟
- [ ] آیا تمام عملیات مهم لاگ دارند؟
- [ ] آیا تمام خطاها لاگ می‌شوند؟
- [ ] آیا context مناسب ارائه شده؟
- [ ] آیا دسته‌بندی صحیح انتخاب شده؟

### 💡 **یادآوری مداوم:**
این سیستم لاگ‌گیری یکی از مهم‌ترین بخش‌های پروژه است و نباید هرگز فراموش شود. در هر کد جدید، ابتدا به لاگ‌گیری فکر کنید، سپس کد را بنویسید.


## قوانین چت کردن
1. همیشه در محیط چت به زبان فارسی پاسخ دهید
2. پاسخ‌ها باید مختصر، مفید و مرتبط با موضوع باشند
3. از ارائه اطلاعات نادرست یا گمراه‌کننده خودداری کنید
4. مراحل کدنویسی را مرحله به مرحله انجام دهید و منتظر دستور بعدی بمانید
5. در صورت نیاز به اطلاعات بیشتر، سوالات واضح و مشخص بپرسید
6. از اشتباهات خود درس بگیرید و در پاسخ‌های بعدی دقت

## به‌روزرسانی دستورالعمل
این فایل دستورالعمل باید در شرایط زیر به‌روزرسانی شود:
1. تغییر در الزامات پروژه
2. اضافه شدن تکنولوژی یا کتابخانه جدید
3. تغییر در ساختار پروژه
4. اضافه شدن قابلیت‌های جدید
5. تغییر در استانداردهای کدنویسی

---

# ⚡ یادآوری فوری برای هر کدنویسی

## 🚨 قبل از شروع هر کد، این موارد را چک کنید:

### 1. **Logger فراخوانی شده؟**
```php
require_once 'app/helpers/Autoloader.php';
Autoloader::register();
```

### 2. **تمام عملیات لاگ دارند؟**
- ✅ ورود به function: `Logger::info()`
- ✅ عملیات دیتابیس: `Logger::database()`
- ✅ فراخوانی API: `Logger::api()`
- ✅ خطاها: `Logger::error()`
- ✅ موفقیت: `Logger::success()`

### 3. **Exception handling کامل است؟**
```php
try {
    // code
} catch (Exception $e) {
    Logger::error('خطا', 'Error', ['error' => $e->getMessage()]);
    // handle error
}
```

### ⚠️ **هرگز این کارها را نکنید:**
- ❌ کد بدون لاگ ننویسید
- ❌ خطا بدون لاگ نگذارید  
- ❌ عملیات مهم بدون لاگ انجام ندهید

**🎯 یادآوری: سیستم لاگ‌گیری = قلب پروژه - هرگز فراموش نکنید!**
